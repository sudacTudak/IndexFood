"use strict";document.addEventListener("DOMContentLodaed",(()=>{}));const swiper=new Swiper(".swiper",{loop:!0,navigation:{nextEl:".slider-button-next",prevEl:".slider-button-prev"}}),auth=()=>{const t=document.querySelector(".login"),e=document.querySelector(".logout"),a=document.querySelector(".user-name"),o=document.forms.formAuth,c=a.nextElementSibling,n=c.nextElementSibling;let s=!0,r=!1;const l=t=>{const e=t.nextElementSibling;t.classList.add("_error"),e.classList.add("_error"),e.textContent="Данное поле не может быть пустым"},d=t=>{const e=t.nextElementSibling;t.classList.remove("_error"),e.classList.remove("_error"),e.textContent=""},i=e=>{t.style.display="none",a.textContent=e.name,a.style.display="block",localStorage.setItem("user",JSON.stringify(e))},m=t=>{t.classList.contains("is-open")&&r&&(a.classList.remove("is-open"),c.classList.remove("is-open"),t.classList.remove("is-open"),setTimeout((()=>{r=!1}),500))};localStorage.getItem("user")&&i(JSON.parse(localStorage.getItem("user")));for(let t of o)t.classList.contains("form-button")||t.addEventListener("click",(()=>{t.classList.contains("_error")&&d(t)}));e.addEventListener("click",(e=>{e.preventDefault(),a.textContent="",a.style.display="none",t.style.display="block",localStorage.removeItem("user"),m(n)})),c.addEventListener("click",(()=>{n&&m(n)})),a.addEventListener("click",(()=>{n&&localStorage.getItem("user")&&(t=>{t.classList.contains("is-open")||r||(a.classList.add("is-open"),c.classList.add("is-open"),t.classList.add("is-open"),setTimeout((()=>{r=!0}),500))})(n)})),o.addEventListener("submit",(t=>{t.preventDefault();for(let t of o.elements)t.classList.contains("form-button")||(""===t.value?(l(t),s=!1):s=!0);if(s){const t={};t.name=o.login.value,t.password=o.password.value,i(t),(t=>{fetch("https://jsonplaceholder.typicode.com/posts",{method:"post",body:t}).then((t=>{t.ok&&(alert("Вход выполнен!"),closeModal(o.closest(".modal-auth")))})).catch((t=>{alert("Произошла ошибка при авторизации. Повторите попытку")}))})(t)}}))};auth();const lazyLoad=()=>{const t=document.querySelectorAll("img[data-src]"),e=document.documentElement.clientHeight,a=[];let o=0;const c=()=>{if(a.length>0){let c=a.findIndex((t=>pageYOffset>=t-e));c>=0&&t[c].dataset.src&&(e=>{const c=t[e];c.src=c.dataset.src,c.removeAttribute("data-src"),delete a[e],o--})(c)}};t.length>0&&t.forEach((t=>{t.dataset.src&&(a.push(t.getBoundingClientRect().top+pageYOffset),o++,c())})),window.addEventListener("scroll",(()=>{o>0&&c()}))};lazyLoad();const menu=()=>{const t=document.querySelector(".tabs"),e=document.querySelector(".tabs-content"),a=e.querySelectorAll(".tabs-card"),o=document.querySelector("._load-more");let c=t.querySelector(".active"),n=[];const s=t=>{const e=localStorage.getItem("cart")?JSON.parse(localStorage.getItem("cart")):[];e.some((e=>e.id===t.id))?e.map((e=>(e.id===t.id&&e.count++,e))):e.push(t),localStorage.setItem("cart",JSON.stringify(e)),cartRender(e)},r=()=>{fetch("./db/menu.json").then((t=>{if(t.ok)return t.json()})).then((t=>{(t=>{t.forEach((({name:t,description:a,price:o,image:c,weight:r,category:l,id:d})=>{const i=document.createElement("article");i.classList.add("tabs-card"),i.dataset.category=l,i.innerHTML=`\n                <img src="${c}" alt="${t}" class="tabs-image">\n                <div class="tabs-card-content">\n                    <h3 class="tabs-title">${t}</h3>\n                    <p class="text-description">${a}</p>\n                    <div class="tabs-info">\n                        <div class="tabs-good">\n                            <span class="price">${o} ₽</span>\n                            <span class="weight">${r} гр</span>\n                        </div>\n                        <button data-index="${d}" class="button button-outline button-add-cart">В корзину</button>\n                    </div>\n                </div>\n            `,i.querySelector(".button-add-cart").addEventListener("click",(()=>{s({id:d,name:t,price:o,count:1})})),e.append(i),n.push(i)}))})(t)})).catch((t=>{alert(t)}))};o.addEventListener("click",(()=>{r()})),a.forEach((t=>{const e=t.querySelector(".button-add-cart"),a=e.dataset.index,o=t.querySelector(".price").dataset.price,c=t.querySelector(".tabs-title").textContent;e.addEventListener("click",(()=>{s({id:a,name:c,price:o,count:1})})),n.push(t)})),t.addEventListener("click",(t=>{if("LI"===t.target.tagName&&!t.target.classList.contains("active")){c&&c.classList.remove("active"),t.target.classList.add("active"),c=t.target;const e=t.target.dataset.category;n.forEach((t=>{t.classList.remove("hide"),t.dataset.category.includes(e)||"all"===e||t.classList.add("hide")}))}})),t.firstElementChild.click()};menu();const shoppingCounter=document.querySelector(".shopping-counter"),modalCart=document.querySelector(".modal-cart"),cartWrapper=modalCart.querySelector(".cart-wrapper"),totalPrice=modalCart.querySelector(".total-price"),showCartCounter=t=>{shoppingCounter.classList.add("not-empty"),shoppingCounter.textContent=`${t}`},hideCartCounter=()=>{shoppingCounter.classList.remove("not-empty"),shoppingCounter.textContent="0"},clearCart=()=>{modalCart.classList.add("is-empty"),localStorage.removeItem("cart"),cartWrapper.innerHTML="",totalPrice.innerHTML="0 &#8381",hideCartCounter()},sendCart=t=>{fetch("https://jsonplaceholder.typicode.com/posts",{method:"post",body:t}).then((t=>{t.ok&&(alert("Заказ принят!"),clearCart(),closeModal(modalCart))})).catch((t=>{alert("Ошибка при формировании заказа")}))},incrementCount=t=>{if(localStorage.getItem("cart")){const e=JSON.parse(localStorage.getItem("cart"));e.forEach((e=>{e.id===t&&e.count++})),localStorage.setItem("cart",JSON.stringify(e)),cartRender(e)}},decrementCount=t=>{if(localStorage.getItem("cart")){const e=JSON.parse(localStorage.getItem("cart"));e.forEach((e=>{e.id!==t||e.count<1||e.count--})),localStorage.setItem("cart",JSON.stringify(e)),cartRender(e)}},cartRender=t=>{cartWrapper.innerHTML="";let e=0,a=0;t.forEach((t=>{const{name:o,id:c,price:n,count:s}=t,r=document.createElement("div");r.classList.add("cart-item"),r.innerHTML=`\n                <div class="item-name">${o}</div>\n                <div class="item-count">\n                    <button data-index="${c}" class="button-decrement">-</button>\n                    <div class="item-counter">${s}</div>\n                    <button data-index="${c}" class="button-increment">+</button>\n                </div>\n                <span class="item-price">${n*s} &#8381;</span>\n            `,cartWrapper.append(r),a+=n*s,e+=s})),modalCart.classList.remove("is-empty"),totalPrice.innerHTML=a+" &#8381;",e>0?showCartCounter(e):hideCartCounter()};if(localStorage.getItem("cart")){const t=JSON.parse(localStorage.getItem("cart"));cartRender(t)}modalCart.addEventListener("click",(t=>{var e;t.target.classList.contains("button-increment")&&incrementCount(t.target.dataset.index),t.target.classList.contains("button-decrement")&&decrementCount(t.target.dataset.index),t.target.closest(".cart-clear")&&(modalCart.classList.contains("is-empty")||clearCart()),t.target.closest(".cart-send")&&localStorage.getItem("cart")&&localStorage.getItem("cart")&&(e=JSON.parse(localStorage.getItem("cart")),fetch("https://jsonplaceholder.typicode.com/posts",{method:"post",body:e}).then((t=>{t.ok&&(alert("Заказ принят!"),clearCart(),closeModal(modalCart))})).catch((t=>{alert("Ошибка при формировании заказа")})))}));const modalOpeners=document.querySelectorAll(".modal-caller"),modalClosers=document.querySelectorAll(".modal-close"),contentWrapper=document.querySelector(".wrapper"),lockPadding=document.querySelectorAll(".lock-padding"),body=document.body;let unlock=!0;const timeout=800,unlockBody=()=>{setTimeout((()=>{lockPadding&&lockPadding.forEach((t=>{t.style.paddingRight="0px"})),body.style.paddingRight="0px",body.classList.remove("locked")}),800),unlock=!1,setTimeout((()=>{unlock=!0}),800)},lockBody=()=>{const t=window.innerWidth-contentWrapper.offsetWidth+"px";lockPadding&&lockPadding.forEach((e=>{e.style.paddingRight=t})),body.style.paddingRight=t,body.classList.add("locked"),unlock=!1,setTimeout((()=>{unlock=!0}),800)},checkClickTarget=t=>{t.target.closest(".modal-content")||closeModal(t.target.closest(".modal"))},openModal=t=>{unlock&&(t.classList.add("is-open"),t.addEventListener("click",checkClickTarget,"once"),lockBody())},closeModal=t=>{unlock&&(t.classList.remove("is-open"),t.removeEventListener("click",checkClickTarget),setTimeout((()=>{lockPadding&&lockPadding.forEach((t=>{t.style.paddingRight="0px"})),body.style.paddingRight="0px",body.classList.remove("locked")}),800),unlock=!1,setTimeout((()=>{unlock=!0}),800))};modalOpeners.length>0&&modalOpeners.forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault();const a=t.getAttribute("href").replace("#",""),o=document.getElementById(a);var c;c=o,unlock&&(c.classList.add("is-open"),c.addEventListener("click",checkClickTarget,"once"),lockBody())}))})),modalClosers.length>0&&modalClosers.forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault(),closeModal(t.closest(".modal"))}))}));